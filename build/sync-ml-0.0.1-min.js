!function(a){var b={uuid:function(){var a,b,c="";for(a=0;32>a;a++)b=16*Math.random()|0,(8===a||12===a||16===a||20===a)&&(c+="-"),c+=(12===a?4:16===a?3&b|8:b).toString(16);return c},copy:function(a){return JSON.parse(JSON.stringify(a))}},c=function(a){this.sync_op=f.OP.NONE,this.sync_uuid=b.uuid(),this.userData=a},d=function(a){this.items=[],this.uuid="sync_"+a,this.init=function(){this.items=this.getItemsFromStore()},this.add=function(a,b){var d=new c(b);return d.sync_op=a,this.items.unshift(d),this.saveItemsToStore(),d},this.addBulk=function(a){for(var b=0;b<a.length;b++){var d=new c(a[b]);d.sync_op=f.OP.NONE,this.items.push(d)}this.saveItemsToStore()},this.remove=function(a){var b=this.getIndexById(a);if(b>=0){var c=this.items.splice(b,1);return this.saveItemsToStore(),c[0]}},this.update=function(a,b,c){var d=this.getIndexById(a);return d>=0?(this.items[d].userData=c,this.items[d].sync_op=b,this.saveItemsToStore(),this.items[d]):void 0},this.empty=function(){this.items=[],this.saveItemsToStore()},this.saveItemsToStore=function(){localStorage.setItem(this.uuid,JSON.stringify(this.items))},this.getItemsFromStore=function(){var a=localStorage.getItem(this.uuid);return"undefined"!=typeof a&&null!==a?JSON.parse(a):[]},this.getItems=function(){return b.copy(this.items)},this.getItemsExcluding=function(a){return jQuery(this.getItems()).filter(function(){return this.sync_op!==a})},this.getItemById=function(a){var b=this.getIndexById(a);return b>=0?this.items[b]:null},this.getIndexById=function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].sync_uuid===a)return b;return-1}},e={isInitialized:!1,init:function(b,c,d){if("function"==typeof b&&"function"==typeof c){this.isInitialized=!0;var d="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js";a.location.hostname.indexOf("localhost")<0&&(d=a.location.protocol+"//"+a.location.hostname+(a.location.port?":":"")+a.location.port),$(document).isOffline({baseUrl:d}).bind("isOnline",b).bind("isOffline",c)}},triggerCallbacks:function(){this.isInitialized&&$(document).data("plugin_isOffline").check()}},f=function(){this.apiHandler=null,this.init=function(a,b){if(this.apiHandler=a,"function"!=typeof a.add||"function"!=typeof a.update||"function"!=typeof a.remove||"function"!=typeof a.getData)throw"Api Handler doesn't implement the expected interface!";"function"==typeof this.apiHandler.init&&this.apiHandler.init(b)},this.promiseHandler=function(a,b){a.done(function(a){b(null,a)}),a.fail(function(a){b(a,null)})},this.send=function(a,b){var c=null;switch(a.sync_op){case f.OP.ADD:c=this.apiHandler.add(a.userData);break;case f.OP.UPDATE:c=this.apiHandler.update(a.userData);break;case f.OP.DELETE:c=this.apiHandler.remove(a.userData);break;default:console.error("syncer couldn't find an operation to perform on an item!")}null!==c&&this.promiseHandler(c,b)},this.get=function(a){this.promiseHandler(this.apiHandler.getData(),a)}};f.OP={NONE:0,ADD:1,UPDATE:2,DELETE:3};var g=function(a){var b=e,c=new d(a),h=new f,i=!1;this.callbackOnSync=null,this.init=function(a,d){this.callbackOnSync="function"==typeof d?d:null;try{h.init(a)}catch(e){console.error(e),h=null}b.init(g.onConnect.bind(this),g.onDisconnect.bind(this)),c.init(),this.sync(this.callbackOnSync)},this.syncItem=function(a,b){h.send(a,function(d,e){null===d&&(a.sync_op!==f.OP.DELETE?c.update(a.sync_uuid,f.OP.NONE,e):c.remove(a.sync_uuid)),b(d,{sync_id:a.sync_uuid,obj:a.userData})})},this.add=function(a,b){var d=c.add(f.OP.ADD,a);this.syncItem(d,b)},this.update=function(a,b,d){var e=c.getItemById(a);e=e.sync_op==f.OP.ADD?c.update(a,f.OP.ADD,b):c.update(a,f.OP.UPDATE,b),this.syncItem(e,d)},this.remove=function(a,b,d){var e=c.getItemById(a);return e.sync_op==f.OP.ADD||e.sync_op==f.OP.UPDATE?(e=c.remove(a),void d(null,{sync_id:e.sync_uuid,obj:e.userData})):(e=c.update(a,f.OP.DELETE,b),void this.syncItem(e,d))},this.sync=function(a){if(i)return void console.log("sync is already in progress!");console.log("sync started!"),i=!0;var b=c.getItemsExcluding(f.OP.NONE),d=[];if(b.length>0)for(var e=0;e<b.length;e++){var g=b[e];this.syncItem(g,function(){d.push(g),d.length===b.length&&j(a)})}else j(a)};var j=function(a){h.get(function(b,d){null==b&&(c.empty(),c.addBulk(d)),a(b,k()),i=!1,console.log("finished syncing")})},k=function(){for(var a=c.getItemsExcluding(f.OP.DELETE),b=[],d=0;d<a.length;d++){var e=a[d];b.push({sync_id:e.sync_uuid,obj:e.userData})}return b};this.get=function(a){a(k())},this.isSyncing=function(){return i}};g.onConnect=function(){this.sync(this.callbackOnSync)},g.onDisconnect=function(){console.log("disconnected!")},a.SyncModule=g}(window);